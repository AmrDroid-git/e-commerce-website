{% extends 'base.html.twig' %}

{% block title %}ScriptSphere - Dashboard{% endblock %}

{% block body %}
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ScriptSphere - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ asset('css/dashboard.css') }}">
</head>
<body>

<!-- Top Navbar -->
<nav class="navbar navbar-expand-lg  px-4" style="background-color: #1e1b4b">
    <a href="#" class="navbar-logo">ScriptSphere</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="mainNavbar">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item"><a class="nav-link active" href="#dashboard" style="color: white"><i class="fas fa-home me-1"></i>Dashboard</a></li>
            <li class="nav-item"><a class="nav-link" href="#products"><i class="fas fa-box-open me-1"></i>My Products</a></li>
            <li class="nav-item"><a class="nav-link" href="#purchases"><i class="fas fa-shopping-bag me-1"></i>Purchases</a></li>
            <li class="nav-item"><a class="nav-link" href="#favorites"><i class="fas fa-heart me-1"></i>Favorites</a></li>
            <li class="nav-item"><a class="nav-link" href="#account"><i class="fas fa-user me-1"></i>Account</a></li>
            <li class="nav-item"><a class="nav-link" href="#support"><i class="fas fa-question-circle me-1"></i>Support</a></li>
        </ul>

        <div class="d-flex align-items-center gap-3">
            <div class="position-relative">
                <i class="fas fa-bell text-white"></i>
                <span class="badge bg-danger rounded-circle position-absolute top-0 start-100 translate-middle p-1">3</span>
            </div>
            <a href="{{ path('app_logout') }}" class="btn btn-outline-light btn-sm"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </div>
    </div>
</nav>

<div class="w-100 px-4 mt-4" id="dashboardContent">

    <!-- Entête admin -->
    <div class="page-header mb-4">
        <div class="d-flex align-items-center text-white">
            <img src="https://www.w3schools.com/howto/img_avatar.png" alt="Admin" style="width: 50px; height: 50px; border-radius: 50%;" class="me-2">
            <h1>Welcome, Admin</h1>
        </div>
        <p>Overview of the platform’s latest statistics and activities.</p>
    </div>

    <!-- Statistiques -->
    <div class="row stats-row mb-4">
        <div class="col-md-3">
            <div class="stat-card purple">
                <div class="stat-icon"><i class="fas fa-users"></i></div>
                <div class="stat-info"><h3>{{ userCount }}</h3><p>Registered Users</p></div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card blue">
                <div class="stat-icon"><i class="fas fa-box-open"></i></div>
                <div class="stat-info"><h3>{{ productCount }}</h3><p>Products Available</p></div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card green">
                <div class="stat-icon"><i class="fas fa-dollar-sign"></i></div>
                <div class="stat-info"><h3>{{ totalSales }}$</h3><p>Total Sales</p></div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card orange">
                <div class="stat-icon"><i class="fas fa-headset"></i></div>
                <div class="stat-info"><h3>{{ commandeCount }}</h3><p>Pending Tasks</p></div>
            </div>
        </div>
    </div>

    <!-- Activité récente -->
    <div class="card mb-4 activity-card">
        <div class="card-header d-flex justify-content-between">
            <h3>Recent Admin Activity</h3>
{#            <a href="#" class="btn btn-sm btn-outline-primary">View All Logs</a>#}
        </div>
        <div class="card-body">
            <ul class="activity-list">
                {% for user in latestUsers %}
                    <li>
                        <div class="activity-icon"><i class="fas fa-user-plus"></i></div>
                        <div class="activity-details">
                            <p>New user <strong>{{ user.username }}</strong> registered</p>
{#                            <small>{{ user.createdAt|date('Y-m-d H:i') }}</small>#}
                        </div>
                    </li>
                {% else %}
                    <li><em>No recent user registrations.</em></li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <!-- Produits en attente de validation -->
    <div class="card products-card">
        <div class="card-header d-flex justify-content-between">
            <h3>Highest Rated</h3>
        </div>
        <div class="row">
            {% for product in topProducts %}
                <div class="col-md-4">
                    <div class="product-recommendation">
                        <img
                                src="{{ asset('uploads/products/' ~ product.imageUrl) }}"
                                alt="{{ product.name }}"
                                class="img-fluid rounded mb-2"
                        >
                        <div class="product-info">
                            <h4>{{ product.name }}</h4>
                            <p class="price">{{ product.price }}€</p>
                            <div class="rating">
                                {% set ratings = product.ratings %}
                                {% set avg = 0 %}
                                {% if ratings|length > 0 %}
                                    {% set sum = 0 %}
                                    {% for r in ratings %}
                                        {% set sum = sum + r.value %}
                                    {% endfor %}
                                    {% set avg = (sum / ratings|length)|round(1) %}
                                {% endif %}
                                {% for i in 1..5 %}
                                    {% if i <= avg %}
                                        <i class="fas fa-star text-warning"></i>
                                    {% elseif (i - avg) < 1 %}
                                        <i class="fas fa-star-half-alt text-warning"></i>
                                    {% else %}
                                        <i class="far fa-star text-warning"></i>
                                    {% endif %}
                                {% endfor %}
                                <span>({{ ratings|length }})</span>
                            </div>
                            <a href="{{ path('product_show', { id: product.id }) }}"
                               class="btn btn-sm btn-primary mt-2">
                                View Details
                            </a>
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="col-12">
                    <p class="text-muted">No recommended products at this time.</p>
                </div>
            {% endfor %}
        </div>
        </div>
    </div>

</div> <!-- Fin contenu admin -->

<script src="{{ asset('js/script.js') }}"></script>
</body>
</html>
{% endblock %}
